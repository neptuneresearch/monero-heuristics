-- List some transaction hashes
/*
    Top 20:
        "block_height","tx_index","upper"
        3083,1,"7CCDB8992B73D5FA9B284FEF2387A4C8D599DC743685041093194BE8187D3787"
        8330,1,"68189CADEBDEC7E5F969544FF45427AF2B7CC9E92ECD6BC082E09DED15C50371"
        10352,1,"878945AA494A357DFC951FBF73F09112448173D85F4DCE9F0B79306714D18FE1"
        13778,1,DA7EC932567ED9108B411F82F93477F50E7C9971C9E8B767FEFF55726F66F15B
        14940,1,"9F452F7205790C65CEA8708BA910A899E6C1924F9E1F054A1F473D96260F8053"
        16362,1,E1E07978F72B1687536440D68965C7DDA7C4175245E17DCEE18E54EB2B13EE23
        16403,1,CC6A3B641AF736856E38C26EC73358FC7B97FF965120A1DEAF5D085453B281E4
        16409,2,B19FC3F0F83499B9099BFAFC7350D9B313B53A79C91645F90B06122E6E85A7D8
        18169,1,"805D7A024C38BACA36DD1C7CBD6D93A51BAD899F055AC09C7D2197602C22212A"
        18177,1,AE783CA1A04E0EB3FDB0682ABF6AA0EEEF86226F8630ECAE0C36A5A56E1B9C58
        18693,1,DDCF3D036A2F1751E248DB118FF1F323180A0F28E9F64741B92844DE5431C54E
        18699,1,"555B2777AEA7E48F14D13B7C7A40DCCA3B4985F5DA16DB83F19AB2731ED8DD54"
        18704,1,"6D99FD3394469CBF04C6B6C4F276F90197CF6FB11F9EE537C3585394913706D7"
        18706,1,"183EA0493D8E796ADFF047C5247608896394CEFD27B467A9D656991BE961014F"
        18709,1,"2433B8AA410F6041C68D232B0900A4DB53A94A5806A09BAEDCFC50F77F20A028"
        18712,1,"7C34A21B0A0DBD20CAFBC5FC6EAB8915F69D742FBD97E9B01A5D5DFBE8BBA4EF"
        20113,1,"0E5AE23D67C31F3C055389B6477C5FBF1255243B9548DFCB5E7957B2304E9FC6"
        20894,1,B4333446BF8E2EC20DB5EE8262C8662E38D492EA0C1D61C926530426A4FCB5C8
        20919,3,"4E0C70BFE5DD0A8D226F5482FEC103DC00A078B02CE5DB8B82CA8D88B51F5F6D"
        22835,1,E6C9CC9A67C0DAFF651A9EE2F5C2622EE1517348F02B675891B949B7040BC12B

    Bottom 20:
        "block_height","tx_index","upper"
        1118879,1,A568F1218FECAD414CE4EEA54E2DFF73A64E3CB83DF6D355498ABC792991586C
        1030859,1,"32589EB32D31A8F2E46C78E56FC2E24DF063A35F2C294DB3EB6BB754152AA90F"
        1026209,2,"7D83F6573ED300BB55900A00078EDBD4661CA8311EEB29F85F1A2D4DCECFCC89"
        1022483,2,"3F8C14D573A8FECD38D8D8ADDE224911DDF912952E9FE4B3BD637D944DFB527A"
        1019342,8,"812E00A98606353B929C201C449A7E2376739FBA01F0B6471062D3DA708946BE"
        1017164,2,"22736480EA2ED0FDF6B663DD5CCDF430CA845BA35A54ABC4B432E735D6F1F0CE"
        1007981,1,D43401E352E59C22D86D02B937E480990047C32234C89FCC38E03D15FA53EC23
        1007977,1,F36B73B590673C377D8BC8F16FF07786BE14EF95BDFDA47E56A0E1E9A75742B2
        1007976,1,"772153245688B75CD293FE38CD8C6A0ED9BE91ACA3C875779428118FC3854D21"
        1007975,1,DFBC510C34D8B2A3A02D2D787DFF914BA384E7FEAC239E242EFDDF00C308CF54
        1007974,1,F270D272DD7B48456D2C3494433AE44F0B0C3DDDC57745554F962446FACB3E86
        1007973,1,"57C1DBE1E16672D1DAD83D809A91B657CCFABA6242B760D494B1535871C58020"
        1007972,1,"5819AD6BDDB3CDCD50B356A802CB67AAB57E98D63DC173E6B46BE41F4570E34C"
        1007970,2,"2CB726528501C77F7D8715C9639A61F3DCF5E6A8DCA902CC29E0248C26A9BEE5"
        1007970,1,"899C6FCA9AF1966D774482FF1EB0B9B1E377D459680F92C335E445E18CAAE6D8"
        1007969,1,"775BF55499DBF1DA90334B8DEC39330E6160B26A503E5AC55CD468B941C02880"
        997411,1,F2CEB60C7FA56790642FF6633258F381378E4644AD78A5E27CD6900FD6103488
        995722,2,"900176744601D19836D097CFFEFE32F9F319634EE74C003581C3217D436F211B"
        991746,1,"187A0EB91CA56D5A9BAA1BBDE878380BCF20050101AED07DE627E18FCA473EA2"
        982638,1,"49F34B2EA078F1ACFF997750033BA0B6BAA2D0BFC29A515EDC45DBF284AF3231"
*/
-- This query was apparently a heavy request, 2.8M inputs + JOIN to get the hash + DISTINCT that table
-- Reading the top 10 rows was quick (this query with LIMIT 10) but the bottom 10 rows (ORDER BY DESC instead + LIMIT 10) was not,
-- so let's move it to a materialized view
CREATE MATERIALIZED VIEW tx_input_ring_size_sametx_diffinput_diffringsize_tx AS
SELECT DISTINCT
	I.block_height,
	I.tx_index,
	UPPER(ENCODE(I.tx_hash, 'hex'))
FROM tx_input_ring_size_sametx_diffinput_diffringsize Q
JOIN tx_input_list I ON I.block_height = Q.block_height AND I.tx_index = Q.tx_index
ORDER BY I.block_height ASC, I.tx_index ASC
WITH NO DATA;

-- Load: runtime 21m50s
REFRESH MATERIALIZED VIEW tx_input_ring_size_sametx_diffinput_diffringsize_tx;

-- Read top 20
SELECT * 
FROM tx_input_ring_size_sametx_diffinput_diffringsize_tx
LIMIT 20;

-- Read bottom 20
SELECT * 
FROM tx_input_ring_size_sametx_diffinput_diffringsize_tx
ORDER BY block_height DESC
LIMIT 20;